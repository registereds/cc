CREATE TABLE campus (id BIGINT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, abbv VARCHAR(100) NOT NULL, city_id BIGINT, slug VARCHAR(255), UNIQUE INDEX nameindex_idx (name), UNIQUE INDEX campus_sluggable_idx (slug), INDEX city_id_idx (city_id), PRIMARY KEY(id)) ENGINE = MyISAM;
CREATE TABLE category (id BIGINT AUTO_INCREMENT, name VARCHAR(255) NOT NULL, description VARCHAR(255) DEFAULT '' NOT NULL, ranking BIGINT DEFAULT 0 NOT NULL, module VARCHAR(255), slug VARCHAR(255), UNIQUE INDEX category_sluggable_idx (slug), PRIMARY KEY(id)) ENGINE = MyISAM;
CREATE TABLE city (id BIGINT AUTO_INCREMENT, name VARCHAR(100) NOT NULL, PRIMARY KEY(id)) ENGINE = MyISAM;
CREATE TABLE comment (id BIGINT AUTO_INCREMENT, listing_id BIGINT, user_id BIGINT, parent_id BIGINT, description TEXT NOT NULL, audit_status VARCHAR(255) DEFAULT 'new', created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, deleted_at DATETIME, INDEX listing_id_idx (listing_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = MyISAM;
CREATE TABLE image (id BIGINT AUTO_INCREMENT, listing_id BIGINT, user_id BIGINT, name VARCHAR(255) NOT NULL, description VARCHAR(255) DEFAULT '' NOT NULL, url TEXT NOT NULL, audit_status VARCHAR(255) DEFAULT 'new', created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, deleted_at DATETIME, INDEX listing_id_idx (listing_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = MyISAM;
CREATE TABLE listing_index (keyword VARCHAR(200), field VARCHAR(50), position BIGINT, id BIGINT, PRIMARY KEY(keyword, field, position, id)) ENGINE = MyISAM;
CREATE TABLE listing (id BIGINT AUTO_INCREMENT, category_id BIGINT, campus_id BIGINT, city_id BIGINT, user_id BIGINT, module VARCHAR(255), status VARCHAR(255), name VARCHAR(100) NOT NULL, description LONGTEXT DEFAULT '' NOT NULL, contact VARCHAR(255) DEFAULT '' NOT NULL, category_slug VARCHAR(255) NOT NULL, campus_slug VARCHAR(255) NOT NULL, audit_status BIGINT DEFAULT 0 NOT NULL, count_view BIGINT DEFAULT 1 NOT NULL, count_report BIGINT DEFAULT 0 NOT NULL, expires_at DATETIME NOT NULL, deleted_at DATETIME NOT NULL, event_start_at DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, slug VARCHAR(255), INDEX category_id_idx (category_id), INDEX user_id_idx (user_id), INDEX campus_id_idx (campus_id), INDEX city_id_idx (city_id), PRIMARY KEY(id)) ENGINE = MyISAM;
CREATE TABLE location (pcode VARCHAR(4), locality VARCHAR(100), state VARCHAR(3), PRIMARY KEY(pcode, locality, state)) ENGINE = MyISAM;
CREATE TABLE mail_message (id BIGINT AUTO_INCREMENT, message LONGBLOB NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE tag (listing_id BIGINT, text VARCHAR(255), weight BIGINT, PRIMARY KEY(listing_id, text)) ENGINE = MyISAM;
CREATE TABLE user (id BIGINT AUTO_INCREMENT, nick_name VARCHAR(50) NOT NULL, email VARCHAR(255) NOT NULL UNIQUE, password VARCHAR(12) NOT NULL, password_hash VARCHAR(40) NOT NULL, salt VARCHAR(32) NOT NULL, reset_password_hash VARCHAR(40) NOT NULL, reset_expire_at BIGINT DEFAULT '0' NOT NULL, register_hash VARCHAR(32) NOT NULL, last_signin_at BIGINT DEFAULT '0' NOT NULL, status VARCHAR(255), campus_id BIGINT, city_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX campus_id_idx (campus_id), INDEX city_id_idx (city_id), PRIMARY KEY(id)) ENGINE = MyISAM;
ALTER TABLE campus ADD CONSTRAINT campus_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
ALTER TABLE comment ADD CONSTRAINT comment_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE SET NULL;
ALTER TABLE comment ADD CONSTRAINT comment_listing_id_listing_id FOREIGN KEY (listing_id) REFERENCES listing(id) ON DELETE SET NULL;
ALTER TABLE image ADD CONSTRAINT image_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE SET NULL;
ALTER TABLE image ADD CONSTRAINT image_listing_id_listing_id FOREIGN KEY (listing_id) REFERENCES listing(id) ON DELETE SET NULL;
ALTER TABLE listing_index ADD CONSTRAINT listing_index_id_listing_id FOREIGN KEY (id) REFERENCES listing(id) ON UPDATE CASCADE ON DELETE CASCADE;
ALTER TABLE listing ADD CONSTRAINT listing_user_id_user_id FOREIGN KEY (user_id) REFERENCES user(id) ON DELETE SET NULL;
ALTER TABLE listing ADD CONSTRAINT listing_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
ALTER TABLE listing ADD CONSTRAINT listing_category_id_category_id FOREIGN KEY (category_id) REFERENCES category(id) ON DELETE SET NULL;
ALTER TABLE listing ADD CONSTRAINT listing_campus_id_campus_id FOREIGN KEY (campus_id) REFERENCES campus(id) ON DELETE SET NULL;
ALTER TABLE tag ADD CONSTRAINT tag_listing_id_listing_id FOREIGN KEY (listing_id) REFERENCES listing(id) ON DELETE CASCADE;
ALTER TABLE user ADD CONSTRAINT user_city_id_city_id FOREIGN KEY (city_id) REFERENCES city(id) ON DELETE SET NULL;
ALTER TABLE user ADD CONSTRAINT user_campus_id_campus_id FOREIGN KEY (campus_id) REFERENCES campus(id) ON DELETE SET NULL;
